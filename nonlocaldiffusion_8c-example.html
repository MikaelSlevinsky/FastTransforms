<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FastTransforms: nonlocaldiffusion.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">FastTransforms
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">nonlocaldiffusion.c</div></div>
</div><!--header-->
<div class="contents">
<p>This example calculates the spectrum of the nonlocal diffusion operator:   </p><p class="formulaDsp">
\[
\mathcal{L}_\delta u = \int_{\mathbb{S}^2} \rho_\delta(|\mathbf{x}-\mathbf{y}|)\left[u(\mathbf{x}) - u(\mathbf{y})\right] \,\mathrm{d}\Omega(\mathbf{y}),
\]
</p>
<p> defined in Eq. (2) of</p>
<p>R. M. Slevinsky, H. Montanelli, and Q. Du, <a href="https://doi.org/10.1016/j.jcp.2018.06.024">A spectral method for nonlocal diffusion operators on the sphere</a>, <em>J. Comp. Phys.</em>, <b>372</b>:893&ndash;911, 2018.</p>
<p>In the above, \(0&lt;\delta&lt;2\), \(-1&lt;\alpha&lt;1\), and the kernel:   </p><p class="formulaDsp">
\[
\rho_\delta(|\mathbf{x}-\mathbf{y}|) = \frac{4(1+\alpha)}{\pi \delta^{2+2\alpha}} \frac{\chi_{[0,\delta]}(|\mathbf{x}-\mathbf{y}|)}{|\mathbf{x}-\mathbf{y}|^{2-2\alpha}},
\]
</p>
<p> where \(\chi_I(\cdot)\) is the indicator function on the set \(I\).</p>
<p>This nonlocal operator is diagonalized by spherical harmonics:   </p><p class="formulaDsp">
\[
\mathcal{L}_\delta Y_\ell^m(\mathbf{x}) = \lambda_\ell(\alpha, \delta) Y_\ell^m(\mathbf{x}),
\]
</p>
<p> and its eigenfunctions are given by the generalized Funk&ndash;Hecke formula:   </p><p class="formulaDsp">
\[
\lambda_\ell(\alpha, \delta) = \frac{(1+\alpha) 2^{2+\alpha}}{\delta^{2+2\alpha}}\int_{1-\delta^2/2}^1 \left[P_\ell(t)-1\right] (1-t)^{\alpha-1} \,\mathrm{d} t.
\]
</p>
<p> In the paper, the authors use Clenshaw&ndash;Curtis quadrature and asymptotic evaluation of Legendre polynomials to achieve \(\mathcal{O}(n^2\log n)\) complexity for the evaluation of the first \(n\) eigenvalues. With a change of basis, this complexity can be reduced to \(\mathcal{O}(n\log n)\).</p>
<p>First, we represent:   </p><p class="formulaDsp">
\[
P_n(t) - 1 = \sum_{j=0}^{n-1} \left[P_{j+1}(t) - P_j(t)\right] = -\sum_{j=0}^{n-1} (1-t) P_j^{(1,0)}(t).
\]
</p>
<p> Then, we represent \(P_j^{(1,0)}(t)\) with Jacobi polynomials \(P_i^{(\alpha,0)}(t)\) and we integrate using <a href="https://dlmf.nist.gov/18.9.16">DLMF 18.9.16</a>:   </p><p class="formulaDsp">
\[
\int_x^1 P_i^{(\alpha,0)}(t)(1-t)^\alpha\,\mathrm{d}t = \left\{ \begin{array}{cc} \frac{(1-x)^{\alpha+1}}{\alpha+1} &amp; \mathrm{for~}i=0,\\ \frac{1}{2i}(1-x)^{\alpha+1}(1+x)P_{i-1}^{(\alpha+1,1)}(x), &amp; \mathrm{for~}i&gt;0.\end{array}\right.
\]
</p>
<p> The code below implements this algorithm, making use of the Jacobi&ndash;Jacobi transform <a class="el" href="fasttransforms_8h.html#a6a63fd7b8fc6d2609c420909d576cf9c">ft_plan_jacobi_to_jacobi</a>. For numerical stability, the conversion from Jacobi polynomials \(P_j^{(1,0)}(t)\) to \(P_i^{(\alpha,0)}(t)\) is divided into conversion from \(P_j^{(1,0)}(t)\) to \(P_k^{(0,0)}(t)\), before conversion from \(P_k^{(0,0)}(t)\) to \(P_i^{(\alpha,0)}(t)\).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fasttransforms_8h.html">fasttransforms.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ftutilities.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> oprec(<span class="keyword">const</span> <span class="keywordtype">int</span> n, <span class="keywordtype">double</span> * v, <span class="keyword">const</span> <span class="keywordtype">double</span> alpha, <span class="keyword">const</span> <span class="keywordtype">double</span> delta2) {</div>
<div class="line">    <span class="keywordflow">if</span> (n &gt; 0)</div>
<div class="line">        v[0] = 1;</div>
<div class="line">    <span class="keywordflow">if</span> (n &gt; 1)</div>
<div class="line">        v[1] = (4*alpha+8-(alpha+4)*delta2)/4;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; n-1; i++)</div>
<div class="line">        v[i+1] = (((2*i+alpha+2)*(2*i+alpha+4)+alpha*(alpha+2))/(2*(i+1)*(2*i+alpha+2))*(2*i+alpha+3)/(i+alpha+3) - delta2/4*(2*i+alpha+3)/(i+1)*(2*i+alpha+4)/(i+alpha+3))*v[i] - (i+alpha+1)/(i+alpha+3)*(2*i+alpha+4)/(2*i+alpha+2)*v[i-1];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;This example calculates the spectrum of the nonlocal diffusion\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;operator defined in Eq. (2) of\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t&quot;</span>MAGENTA(<span class="stringliteral">&quot;R. M. Slevinsky, H. Montanelli, and Q. Du, A spectral method for&quot;</span>)<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t&quot;</span>MAGENTA(<span class="stringliteral">&quot;nonlocal diffusion operators on the sphere, J. Comp. Phys.,&quot;</span>)<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t&quot;</span>MAGENTA(<span class="stringliteral">&quot;372:893--911, 2018.&quot;</span>)<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Please see &quot;</span>CYAN(<span class="stringliteral">&quot;https://doi.org/10.1016/j.jcp.2018.06.024&quot;</span>)<span class="stringliteral">&quot; and\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;the online documentation for further details.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> * FMT = <span class="stringliteral">&quot;%17.16e&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> n = 11;</div>
<div class="line">    <span class="keywordtype">double</span> alpha = -0.5, delta = 0.025;</div>
<div class="line">    <span class="keywordtype">double</span> delta2 = delta*delta;</div>
<div class="line">    <span class="keywordtype">double</span> scl = (1+alpha)*(2-delta2/2);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>MAGENTA(<span class="stringliteral">&quot;n = %i&quot;</span>)<span class="stringliteral">&quot;, &quot;</span>MAGENTA(<span class="stringliteral">&quot;α = %1.3f&quot;</span>)<span class="stringliteral">&quot;, and &quot;</span>MAGENTA(<span class="stringliteral">&quot;δ = %1.3f&quot;</span>)<span class="stringliteral">&quot;.\n&quot;</span>, n, alpha, delta);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> lambda[n];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (n &gt; 0)</div>
<div class="line">        lambda[0] = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (n &gt; 1)</div>
<div class="line">        lambda[1] = -2;</div>
<div class="line">    oprec(n-2, lambda+2, alpha, delta2);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; n; i++)</div>
<div class="line">        lambda[i] *= -scl/(i-1);</div>
<div class="line"> </div>
<div class="line">    ft_tb_eigen_FMM * P = <a id="a0" name="a0"></a><a class="code hl_function" href="fasttransforms_8h.html#a6a63fd7b8fc6d2609c420909d576cf9c">ft_plan_jacobi_to_jacobi</a>(0, 0, n-1, 0, 0, alpha, 0);</div>
<div class="line"> </div>
<div class="line">    ft_bfmv(<span class="charliteral">&#39;T&#39;</span>, P, lambda+1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; n; i++)</div>
<div class="line">        lambda[i] = ((2*i-1)*lambda[i] + (i-1)*lambda[i-1])/i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; n; i++)</div>
<div class="line">        lambda[i] += lambda[i-1];</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;The spectrum, &quot;</span>MAGENTA(<span class="stringliteral">&quot;0 ≤ ℓ &lt; %i&quot;</span>)<span class="stringliteral">&quot;, &quot;</span>, n);</div>
<div class="line">    printmat(MAGENTA(<span class="stringliteral">&quot;λ_ℓ(α,δ)&quot;</span>), FMT, lambda, n, 1);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    ft_destroy_tb_eigen_FMM(P);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="afasttransforms_8h_html"><div class="ttname"><a href="fasttransforms_8h.html">fasttransforms.h</a></div><div class="ttdoc">fasttransforms.h is the main header file for FastTransforms.</div></div>
<div class="ttc" id="afasttransforms_8h_html_a6a63fd7b8fc6d2609c420909d576cf9c"><div class="ttname"><a href="fasttransforms_8h.html#a6a63fd7b8fc6d2609c420909d576cf9c">ft_plan_jacobi_to_jacobi</a></div><div class="ttdeci">ft_tb_eigen_FMM * ft_plan_jacobi_to_jacobi(const int norm1, const int norm2, const int n, const double alpha, const double beta, const double gamma, const double delta)</div><div class="ttdoc">Pre-compute a factorization of the connection coefficients between Jacobi polynomials in double preci...</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
